<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <a href="https://github.com/dirkarnez/dft.js-playground" target="_blank">dirkarnez/dft.js-playground</a><br>
    <div id="here"></div>
    <input type="file" id="input" multiple>
    <script type="module">
        import { DFT } from "https://dirkarnez.github.io/dft.js/esm/dft.js";
        import * as a from "https://cdn.jsdelivr.net/npm/csv-parse@6.1.0/+esm";

        function parseCsvString(inputCSVContent) {
            return new Promise((res, rej) => {
                a.parse(inputCSVContent, { columns: true }, function(err, data) {
                    if(err){
                        rej('Invalid CSV: '+err.message);
                    } else {
                        res(data);
                    }
                });
            })
        }
  
        let globalObj = undefined;
        
        const readText = file => new Promise((resolve) => {
            const reader = new FileReader();

            reader.onload = (event) => {
                resolve({fileName: file.name.substr(0, file.name.lastIndexOf(".")), content: event.target.result })
            }
            reader.readAsText(file)
        });

        const inputElement = document.getElementById("input");
        inputElement.addEventListener("change", function () {
        const fileList = this.files;
            Promise
            .all(
                Array
                .from(fileList)
                .map(file => readText(file)
                    .then(async fileWithMetadata => {
                        const data = await parseCsvString(fileWithMetadata.content);
                        const inputVoltage = data.map(element => element["v(a) "]);
                        const outputVoltage = data.map(element => element["v(b) "]);
                        const samplingFrequency = (1 / (10 * Math.pow(10, -6))).toFixed(2);
                        const ddd = DFT(inputVoltage, samplingFrequency);
                        const eee = DFT(outputVoltage, samplingFrequency);
                        debugger;
                        return ({...fileWithMetadata, data})
                    })
                )
            )
            .then(obj => {
                globalObj = obj;
                console.table(globalObj);
            });
        }, false);
    </script>
</body>
</html>
